{
    "rules": {
        ".read": "auth != null",
        ".write": "auth != null",
        "diagrams": {
            "$diagram_id": {
                ".read": true,
                ".write": "auth != null",

                ".validate": "newData.hasChildren(['diagram', 'authorUid', 'timestamp']) && newData.child('authorUid').isString() && newData.child('timestamp').isNumber()",

                "diagram": { ".validate": "newData.exists()" },
                "authorUid": { ".validate": "newData.val() === auth.uid" },
                "timestamp": { ".validate": "newData.val() <= now" }
            }
        }
    }
}
